<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹»ã®éŠ€æ°´æ™¶ - æ˜Ÿèª­ã¿AI Ã— ãƒã‚¸ã‚«ãƒ«ãƒãƒ¼ãƒˆè¡“</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@300;400;500&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Kiwi Maru', serif;
            background: linear-gradient(to bottom, #1a0033, #330066, #660099);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            padding: 10px;
        }
        
        /* ã‚­ãƒ©ã‚­ãƒ©æ˜Ÿã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes twinkle {
            0%, 100% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes rainbow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes sparkle {
            0%, 100% { 
                box-shadow: 
                    0 0 10px rgba(255, 192, 203, 0.5),
                    0 0 20px rgba(255, 192, 203, 0.3);
            }
            50% { 
                box-shadow: 
                    0 0 20px rgba(255, 192, 203, 0.8),
                    0 0 40px rgba(255, 192, 203, 0.5),
                    0 0 60px rgba(255, 192, 203, 0.3);
            }
        }
        
        @keyframes moonGlow {
            0%, 100% { 
                text-shadow: 
                    0 0 20px rgba(255, 255, 255, 0.8),
                    0 0 40px rgba(255, 255, 255, 0.5);
            }
            50% { 
                text-shadow: 
                    0 0 30px rgba(255, 255, 255, 1),
                    0 0 60px rgba(255, 255, 255, 0.8),
                    0 0 80px rgba(255, 255, 255, 0.5);
            }
        }
        
        .stars {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .star {
            position: absolute;
            background: white;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            animation: twinkle 3s infinite;
        }
        
        .star:nth-child(odd) { animation-delay: 1s; }
        .star:nth-child(even) { animation-delay: 2s; }
        
        .screen {
            max-width: 400px;
            margin: 20px auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 30px;
            border: 2px solid rgba(255, 192, 203, 0.3);
            box-shadow: 0 0 30px rgba(255, 192, 203, 0.3);
            position: relative;
            animation: sparkle 3s infinite;
        }
        
        .magical-title {
            text-align: center;
            font-size: 36px;
            background: linear-gradient(45deg, #ff6ec7, #ffd700, #ff6ec7);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rainbow 5s linear infinite;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(255, 192, 203, 0.5);
        }
        
        .subtitle {
            text-align: center;
            font-size: 14px;
            color: #ffb6c1;
            margin-bottom: 30px;
        }
        
        .moon-phase {
            text-align: center;
            font-size: 48px;
            margin: 20px 0;
            animation: float 3s ease-in-out infinite, moonGlow 2s ease-in-out infinite;
        }
        
        .message-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 192, 203, 0.3);
            text-align: center;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: rotate(45deg);
            transition: all 0.5s;
            opacity: 0;
        }
        
        .card:hover::before {
            animation: shine 0.5s ease-in-out;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); opacity: 0; }
        }
        
        .card:hover {
            transform: translateY(-5px) scale(1.05);
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 10px 30px rgba(255, 192, 203, 0.5);
        }
        
        .card-icon {
            font-size: 48px;
            margin-bottom: 10px;
            display: inline-block;
            animation: float 4s ease-in-out infinite;
        }
        
        .card:nth-child(odd) .card-icon { animation-delay: 0.5s; }
        .card:nth-child(even) .card-icon { animation-delay: 1s; }
        
        .magical-button {
            background: linear-gradient(135deg, #ff6ec7, #ff9472);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            margin: 10px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(255, 110, 199, 0.4);
        }
        
        .magical-button::after {
            content: 'âœ¨';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 20px;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .magical-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 110, 199, 0.6);
        }
        
        .magical-button:hover::after {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.5);
        }
        
        /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  */
        .form-group {
            margin: 20px 0;
        }
        
        .form-group label {
            display: block;
            color: #ffb6c1;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .magical-input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid rgba(255, 192, 203, 0.3);
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .magical-input:focus {
            outline: none;
            border-color: #ff6ec7;
            box-shadow: 0 0 20px rgba(255, 110, 199, 0.5);
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* é­”æ³•ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ */
        .magical-textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid rgba(255, 192, 203, 0.3);
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            resize: none;
            transition: all 0.3s ease;
        }
        
        .magical-textarea:focus {
            outline: none;
            border-color: #ff6ec7;
            box-shadow: 0 0 30px rgba(255, 110, 199, 0.5);
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* ã‚·ãƒ³ãƒœãƒ«é¸æŠ */
        .symbol-grid {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .symbol {
            font-size: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: float 3s ease-in-out infinite;
        }
        
        .symbol:nth-child(1) { animation-delay: 0s; }
        .symbol:nth-child(2) { animation-delay: 0.5s; }
        .symbol:nth-child(3) { animation-delay: 1s; }
        .symbol:nth-child(4) { animation-delay: 1.5s; }
        .symbol:nth-child(5) { animation-delay: 2s; }
        
        .symbol:hover {
            transform: scale(1.3) rotate(360deg);
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.8));
        }
        
        .symbol.selected {
            transform: scale(1.2);
            filter: drop-shadow(0 0 30px rgba(255, 215, 0, 1));
        }
        
        /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ */
        .calendar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-nav {
            background: none;
            border: none;
            color: #ffb6c1;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .calendar-nav:hover {
            transform: scale(1.2);
            color: #ff6ec7;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 15px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .calendar-day:hover {
            background: rgba(255, 110, 199, 0.3);
            transform: scale(1.1);
        }
        
        .calendar-day.special {
            background: rgba(255, 215, 0, 0.2);
            animation: pulse 2s ease-in-out infinite;
        }
        
        .calendar-day.today {
            background: rgba(255, 110, 199, 0.3);
            border: 2px solid #ff6ec7;
        }
        
        .calendar-day.new-moon {
            background: rgba(138, 43, 226, 0.3);
            color: #e6e6fa;
        }
        
        .calendar-day.full-moon {
            background: rgba(255, 215, 0, 0.3);
            color: #fffacd;
        }
        
        /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .calendar-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1001;
            overflow-y: auto;
        }
        
        .calendar-modal-content {
            background: linear-gradient(to bottom, #2a0055, #440088);
            margin: 5% auto;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            border-radius: 30px;
            border: 2px solid rgba(255, 192, 203, 0.5);
            box-shadow: 0 0 50px rgba(255, 192, 203, 0.5);
        }
        
        /* æµã‚Œæ˜Ÿã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .shooting-star {
            position: fixed;
            width: 2px;
            height: 2px;
            background: white;
            box-shadow: 0 0 10px white;
            animation: shoot 3s linear infinite;
        }
        
        @keyframes shoot {
            0% {
                transform: translateX(0) translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateX(-300px) translateY(300px);
                opacity: 0;
            }
        }
        
        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .nav-dots {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
        }
        
        .nav-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .nav-dot.active {
            background: #ff6ec7;
            box-shadow: 0 0 20px #ff6ec7;
        }
        
        .nav-dot:hover {
            transform: scale(1.3);
            background: #ff9472;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ */
        @media (max-width: 768px) {
            body {
                padding: 0;
            }
            
            .screen {
                max-width: 100%;
                margin: 0;
                border-radius: 0;
                padding: 20px;
                min-height: 100vh;
                box-shadow: none;
            }
            
            .magical-title {
                font-size: 28px;
            }
            
            .subtitle {
                font-size: 12px;
            }
            
            .moon-phase {
                font-size: 36px;
            }
            
            .message-box {
                padding: 15px;
                font-size: 14px;
            }
            
            .card {
                padding: 15px;
                margin: 10px 0;
            }
            
            .card-icon {
                font-size: 36px;
            }
            
            .card h3 {
                font-size: 16px;
            }
            
            .card p {
                font-size: 12px !important;
            }
            
            .magical-button {
                padding: 12px 24px;
                font-size: 14px;
            }
            
            .form-group label {
                font-size: 13px;
            }
            
            .magical-input,
            .magical-textarea {
                font-size: 14px;
                padding: 10px 15px;
            }
            
            .magical-textarea {
                min-height: 120px;
            }
            
            .symbol {
                font-size: 32px;
            }
            
            .symbol-grid {
                gap: 15px;
                flex-wrap: wrap;
            }
            
            .calendar-day {
                font-size: 12px;
            }
            
            .nav-dots {
                margin: 20px 0;
                padding-bottom: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .magical-title {
                font-size: 24px;
            }
            
            .message-box p {
                font-size: 14px !important;
            }
            
            .magical-button {
                width: 100%;
                margin: 5px 0;
            }
            
            .form-group {
                margin: 15px 0;
            }
        }
        
        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ff6ec7;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none !important;
        }
        
        /* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .error-message {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            color: #ffcccc;
            font-size: 14px;
            text-align: center;
        }
        
        /* æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .success-message {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid rgba(0, 255, 0, 0.5);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            color: #ccffcc;
            font-size: 14px;
            text-align: center;
        }
        
        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            position: relative;
            background: linear-gradient(to bottom, #2a0055, #440088);
            margin: 10% auto;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            border-radius: 30px;
            border: 2px solid rgba(255, 192, 203, 0.5);
            box-shadow: 0 0 50px rgba(255, 192, 203, 0.5);
            animation: sparkle 3s infinite;
        }
        
        .close-modal {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #ffb6c1;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .close-modal:hover {
            color: #ff6ec7;
            transform: scale(1.2);
        }
    </style>
</head>
<body>
    <!-- æ˜Ÿã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ -->
    <div class="stars" id="stars"></div>
    
    <!-- æµã‚Œæ˜Ÿ -->
    <div class="shooting-star" style="top: 20%; right: 10%;"></div>
    <div class="shooting-star" style="top: 50%; right: 30%; animation-delay: 1s;"></div>
    <div class="shooting-star" style="top: 70%; right: 50%; animation-delay: 2s;"></div>
    
    <!-- ãƒ›ãƒ¼ãƒ ç”»é¢ -->
    <div class="screen" id="home">
        <h1 class="magical-title">å¹»ã®éŠ€æ°´æ™¶</h1>
        <p class="subtitle">æ˜Ÿèª­ã¿AI Ã— ãƒã‚¸ã‚«ãƒ«ãƒãƒ¼ãƒˆè¡“</p>
        
        <div class="moon-phase" id="currentMoonPhase">ğŸŒ™</div>
        
        <div class="message-box">
            <p style="color: #ffd700; font-size: 18px;" id="todayTitle">æ˜Ÿã€…ãŒè¦‹å®ˆã‚‹å¤œ</p>
            <p style="color: #ffb6c1; margin-top: 10px;" id="todayMessage">ã€Œæ–°ã—ã„æ‰‰ã‚’é–‹ãå‹‡æ°—ã‚’æŒã£ã¦ã€‚æœˆã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒã‚ãªãŸã®èƒŒä¸­ã‚’æŠ¼ã—ã¦ã„ã¾ã™ã€</p>
        </div>
        
        <div class="card" onclick="showScreen('horoscope')">
            <div class="card-icon">â­</div>
            <h3>æ˜Ÿã®æµã‚Œã‚’èª­ã‚€</h3>
            <p style="font-size: 14px; color: #ffb6c1;">ã‚ãªãŸã®æœªæ¥ã®ç¯€ç›®ã‚’äºˆæ¸¬</p>
        </div>
        
        <div class="card" onclick="showScreen('note')">
            <div class="card-icon">ğŸ“–</div>
            <h3>é¡˜ã„ã‚’ç´¡ã</h3>
            <p style="font-size: 14px; color: #ffb6c1;">é­”æ³•ã®ãƒãƒ¼ãƒˆã§ç¾å®Ÿå‰µé€ </p>
        </div>
        
        <div class="card" onclick="showScreen('calendar')">
            <div class="card-icon">ğŸŒ›</div>
            <h3>æœˆã®ãƒªã‚ºãƒ </h3>
            <p style="font-size: 14px; color: #ffb6c1;">æœ€é©ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’çŸ¥ã‚‹</p>
        </div>
        
        <div class="card" onclick="showScreen('message')">
            <div class="card-icon">âœ¨</div>
            <h3>ä»Šæ—¥ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h3>
            <p style="font-size: 14px; color: #ffb6c1;">å®‡å®™ã‹ã‚‰ã®å°ãã‚’å—ã‘å–ã‚‹</p>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button class="magical-button" onclick="showScreen('profile')">
                âœ¨ æ˜Ÿèª­ã¿ã®æ—…ã‚’å§‹ã‚ã‚‹
            </button>
        </div>
    </div>
    
    <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®šç”»é¢ -->
    <div class="screen hidden" id="profile">
        <h2 class="magical-title" style="font-size: 28px;">ã‚ãªãŸã®æ˜Ÿã®è¨˜æ†¶</h2>
        
        <div class="message-box">
            <p style="color: #ffd700;">ç”Ÿã¾ã‚ŒãŸç¬é–“ã®æ˜Ÿç©ºã‚’æ•™ãˆã¦ãã ã•ã„</p>
        </div>
        
        <div class="form-group">
            <label>âœ¨ ç”Ÿå¹´æœˆæ—¥</label>
            <input type="date" class="magical-input" id="birthDate">
        </div>
        
        <div class="form-group">
            <label>ğŸŒ™ å‡ºç”Ÿæ™‚é–“ï¼ˆã‚ã‹ã‚Œã°ï¼‰</label>
            <div style="display: flex; gap: 10px;">
                <select class="magical-input" style="flex: 1;" id="birthHour">
                    <option value="">æ™‚</option>
                    <option value="0">0æ™‚</option>
                    <option value="1">1æ™‚</option>
                    <option value="2">2æ™‚</option>
                    <option value="3">3æ™‚</option>
                    <option value="4">4æ™‚</option>
                    <option value="5">5æ™‚</option>
                    <option value="6">6æ™‚</option>
                    <option value="7">7æ™‚</option>
                    <option value="8">8æ™‚</option>
                    <option value="9">9æ™‚</option>
                    <option value="10">10æ™‚</option>
                    <option value="11">11æ™‚</option>
                    <option value="12">12æ™‚</option>
                    <option value="13">13æ™‚</option>
                    <option value="14">14æ™‚</option>
                    <option value="15">15æ™‚</option>
                    <option value="16">16æ™‚</option>
                    <option value="17">17æ™‚</option>
                    <option value="18">18æ™‚</option>
                    <option value="19">19æ™‚</option>
                    <option value="20">20æ™‚</option>
                    <option value="21">21æ™‚</option>
                    <option value="22">22æ™‚</option>
                    <option value="23">23æ™‚</option>
                </select>
                <select class="magical-input" style="flex: 1;" id="birthMinute">
                    <option value="">åˆ†</option>
                    <option value="0">00åˆ†</option>
                    <option value="15">15åˆ†</option>
                    <option value="30">30åˆ†</option>
                    <option value="45">45åˆ†</option>
                </select>
            </div>
        </div>
        
        <div class="form-group">
            <label>ğŸŒ å‡ºç”Ÿåœ°ï¼ˆã‚ã‹ã‚Œã°ï¼‰</label>
            <input type="text" class="magical-input" placeholder="æ±äº¬éƒ½æ¸‹è°·åŒº" id="birthPlace">
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button class="magical-button" onclick="saveProfile()">
                ğŸŒ™ éŠ€æ°´æ™¶ã«è¨˜æ†¶ã™ã‚‹
            </button>
        </div>
        
        <div style="text-align: center; margin-top: 10px;">
            <button class="magical-button" onclick="showScreen('home')" style="background: linear-gradient(135deg, #9370db, #ba55d3);">
                æˆ»ã‚‹
            </button>
        </div>
        
        <div style="text-align: center; margin-top: 10px;">
            <button class="magical-button" onclick="showApiKeyModal()" style="background: linear-gradient(135deg, #ff1493, #ff69b4);">
                ğŸ”‘ APIè¨­å®š
            </button>
        </div>
    </div>
    
    <!-- æ˜Ÿèª­ã¿ç”»é¢ -->
    <div class="screen hidden" id="horoscope">
        <h2 class="magical-title" style="font-size: 28px;">æ˜Ÿã®æµã‚Œåˆ†æ</h2>
        
        <div class="message-box">
            <p style="color: #ffd700; font-size: 16px;">ã‚ãªãŸã®æ˜Ÿåº§</p>
            <p style="color: white; margin-top: 10px; font-size: 24px;" id="zodiacSign">â™ˆ ç‰¡ç¾Šåº§</p>
        </div>
        
        <!-- æœŸé–“åˆ‡ã‚Šæ›¿ãˆã‚¿ãƒ– -->
        <div style="display: flex; justify-content: center; gap: 10px; margin: 20px 0;">
            <button class="magical-button" onclick="changePeriod('1year')" id="btn1year" style="padding: 10px 20px; font-size: 14px;">
                1å¹´
            </button>
            <button class="magical-button" onclick="changePeriod('5years')" id="btn5years" style="padding: 10px 20px; font-size: 14px; background: linear-gradient(135deg, #9370db, #ba55d3);">
                5å¹´
            </button>
            <button class="magical-button" onclick="changePeriod('10years')" id="btn10years" style="padding: 10px 20px; font-size: 14px; background: linear-gradient(135deg, #9370db, #ba55d3);">
                10å¹´
            </button>
        </div>
        
        <div class="card" id="horoscopeContent">
            <h3 style="color: #ffd700;">ä»Šå¾Œ1å¹´ã®é‡è¦ãªè»¢æ›æœŸ</h3>
            <div id="transitionPeriods" style="margin-top: 20px;">
                <div class="transition-item" style="background: rgba(255, 192, 203, 0.1); border-radius: 15px; padding: 15px; margin: 10px 0;">
                    <p style="color: #ffd700; font-weight: bold;">ğŸ“… 2æœˆ14æ—¥ - æ„›ã¨èª¿å’Œã®æ™‚æœŸ</p>
                    <p style="font-size: 14px; margin-top: 5px;">é‡‘æ˜ŸãŒã‚ãªãŸã®æ‹æ„›å®®ã«å…¥ã‚Šã¾ã™ã€‚æ–°ã—ã„å‡ºä¼šã„ã‚„ã€æ—¢å­˜ã®é–¢ä¿‚ãŒæ·±ã¾ã‚‹ãƒãƒ£ãƒ³ã‚¹ã€‚è‡ªåˆ†ã®é­…åŠ›ã‚’ä¿¡ã˜ã¦ç©æ¥µçš„ã«ã€‚</p>
                </div>
                
                <div class="transition-item" style="background: rgba(255, 192, 203, 0.1); border-radius: 15px; padding: 15px; margin: 10px 0;">
                    <p style="color: #ffd700; font-weight: bold;">ğŸ“… 5æœˆ20æ—¥ - å¤‰é©ã¨æˆé•·ã®æ™‚æœŸ</p>
                    <p style="font-size: 14px; margin-top: 5px;">å¤©ç‹æ˜Ÿã®å½±éŸ¿ã§å¤§ããªå¤‰åŒ–ãŒã€‚ã‚­ãƒ£ãƒªã‚¢ã‚„ç”Ÿæ´»ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¦‹ç›´ã™è‰¯ã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‚å¤‰åŒ–ã‚’æã‚Œãšå—ã‘å…¥ã‚Œã¦ã€‚</p>
                </div>
                
                <div class="transition-item" style="background: rgba(255, 192, 203, 0.1); border-radius: 15px; padding: 15px; margin: 10px 0;">
                    <p style="color: #ffd700; font-weight: bold;">ğŸ“… 9æœˆ10æ—¥ - åç©«ã¨é”æˆã®æ™‚æœŸ</p>
                    <p style="font-size: 14px; margin-top: 5px;">åŠªåŠ›ãŒå®Ÿã‚’çµã¶æ™‚ã€‚ã“ã‚Œã¾ã§ã®é ‘å¼µã‚ŠãŒè©•ä¾¡ã•ã‚Œã€æ–°ãŸãªãƒãƒ£ãƒ³ã‚¹ãŒè¨ªã‚Œã¾ã™ã€‚æ„Ÿè¬ã®æ°—æŒã¡ã‚’å¿˜ã‚Œãšã«ã€‚</p>
                </div>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button class="magical-button" onclick="showScreen('home')" style="background: linear-gradient(135deg, #9370db, #ba55d3);">
                æˆ»ã‚‹
            </button>
        </div>
    </div>
    
    <!-- ãƒã‚¸ã‚«ãƒ«ãƒãƒ¼ãƒˆç”»é¢ -->
    <div class="screen hidden" id="note">
        <h2 class="magical-title" style="font-size: 28px;">é¡˜ã„ã‚’ç´¡ã</h2>
        
        <div class="message-box" style="background: rgba(255, 192, 203, 0.2);">
            <p style="color: #ffd700; font-size: 16px;">âœ¨ æ˜ŸãŸã¡ã‹ã‚‰ã®å•ã„ã‹ã‘ âœ¨</p>
            <p style="color: white; margin-top: 10px; font-size: 18px;" id="aiQuestion">
                ã€Œä»Šã®æ˜Ÿã®æµã‚Œã¯ã€ˆå¤‰å®¹ã€‰ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã€‚<br>
                ä½•ã‚’æ‰‹æ”¾ã—ã€ä½•ã‚’å—ã‘å…¥ã‚Œã¾ã™ã‹ï¼Ÿã€
            </p>
        </div>
        
        <div class="form-group">
            <label>ğŸ’– ã‚ãªãŸã®é¡˜ã„ã¨æ„å›³</label>
            <textarea class="magical-textarea" placeholder="å¿ƒã«æµ®ã‹ã‚“ã ã“ã¨ã‚’è‡ªç”±ã«..." id="noteContent"></textarea>
        </div>
        
        <div class="form-group">
            <label>ğŸŒŸ ä»Šã®é¡˜ã„ã«ã´ã£ãŸã‚Šã®ã‚·ãƒ³ãƒœãƒ«ã‚’é¸ã‚“ã§ãã ã•ã„</label>
            <div class="symbol-grid" id="symbolGrid">
                <div style="text-align: center;">
                    <span class="symbol" data-symbol="moon" data-meaning="æ–°ã—ã„å§‹ã¾ã‚Šãƒ»ç›´æ„Ÿ">ğŸŒ™</span>
                    <p style="font-size: 11px; color: #ffb6c1; margin-top: 5px;">æ–°ã—ã„å§‹ã¾ã‚Š</p>
                </div>
                <div style="text-align: center;">
                    <span class="symbol" data-symbol="star" data-meaning="å¸Œæœ›ãƒ»å°ã">â­</span>
                    <p style="font-size: 11px; color: #ffb6c1; margin-top: 5px;">å¸Œæœ›ã¨å°ã</p>
                </div>
                <div style="text-align: center;">
                    <span class="symbol" data-symbol="flower" data-meaning="é–‹èŠ±ãƒ»æˆé•·">ğŸŒ¸</span>
                    <p style="font-size: 11px; color: #ffb6c1; margin-top: 5px;">é–‹èŠ±ã¨æˆé•·</p>
                </div>
                <div style="text-align: center;">
                    <span class="symbol" data-symbol="crystal" data-meaning="æµ„åŒ–ãƒ»ãƒ‘ãƒ¯ãƒ¼">ğŸ’</span>
                    <p style="font-size: 11px; color: #ffb6c1; margin-top: 5px;">æµ„åŒ–ã¨ãƒ‘ãƒ¯ãƒ¼</p>
                </div>
                <div style="text-align: center;">
                    <span class="symbol" data-symbol="butterfly" data-meaning="å¤‰å®¹ãƒ»è‡ªç”±">ğŸ¦‹</span>
                    <p style="font-size: 11px; color: #ffb6c1; margin-top: 5px;">å¤‰å®¹ã¨è‡ªç”±</p>
                </div>
            </div>
            <p style="font-size: 13px; color: #ffb6c1; margin-top: 15px; text-align: center;" id="symbolMessage">
                é¸ã‚“ã ã‚·ãƒ³ãƒœãƒ«ãŒã‚ãªãŸã®é¡˜ã„ã«ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ä¸ãˆã¾ã™
            </p>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button class="magical-button" onclick="saveNote()">
                ğŸŒŸ å®‡å®™ã«é¡˜ã„ã‚’é€ã‚‹
            </button>
        </div>
        
        <div style="text-align: center; margin-top: 10px;">
            <button class="magical-button" onclick="showScreen('home')" style="background: linear-gradient(135deg, #9370db, #ba55d3);">
                æˆ»ã‚‹
            </button>
        </div>
    </div>
    
    <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”»é¢ -->
    <div class="screen hidden" id="calendar">
        <h2 class="magical-title" style="font-size: 28px;">æœˆã®ãƒªã‚ºãƒ </h2>
        
        <div class="calendar">
            <div class="calendar-header">
                <button class="calendar-nav" onclick="changeMonth(-1)">â—€</button>
                <h3 id="currentMonth" style="color: #ffd700;">2025å¹´1æœˆ</h3>
                <button class="calendar-nav" onclick="changeMonth(1)">â–¶</button>
            </div>
            
            <div class="calendar-grid" id="calendarGrid">
                <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¯JSã§ç”Ÿæˆ -->
            </div>
        </div>
        
        <div class="message-box">
            <p style="color: #ffd700;">ä»Šæ—¥ã®æœˆç›¸</p>
            <p style="color: white; margin-top: 10px;" id="moonPhaseInfo">ğŸŒ’ ä¸Šå¼¦ã®æœˆ - è¡Œå‹•ã‚’èµ·ã“ã™æ™‚</p>
        </div>
        
        <div style="text-align: center; margin-top: 10px;">
            <p style="font-size: 13px; color: #ffb6c1;">
                ğŸ“… ã‚¿ãƒƒãƒ—ã—ã¦æ˜Ÿã®æµã‚Œã¨ãƒ¡ãƒ¢ã‚’è¨˜éŒ²
            </p>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button class="magical-button" onclick="showScreen('home')" style="background: linear-gradient(135deg, #9370db, #ba55d3);">
                æˆ»ã‚‹
            </button>
        </div>
    </div>
    
    <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="calendar-modal" id="calendarModal">
        <div class="calendar-modal-content">
            <span class="close-modal" onclick="closeCalendarModal()" style="float: right; font-size: 28px; color: #ffb6c1; cursor: pointer;">&times;</span>
            <h3 class="magical-title" style="font-size: 24px;" id="modalDate">2025å¹´1æœˆ1æ—¥</h3>
            
            <div class="message-box" style="margin-top: 20px;">
                <p style="color: #ffd700;">ã“ã®æ—¥ã®æ˜Ÿã®æµã‚Œ</p>
                <p style="color: white; margin-top: 10px;" id="dayFlow">æ–°æœˆã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒå¼·ã¾ã‚‹æ—¥ã€‚æ–°ã—ã„ã“ã¨ã‚’å§‹ã‚ã‚‹ã®ã«æœ€é©ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã™ã€‚</p>
            </div>
            
            <div class="form-group" style="margin-top: 20px;">
                <label>ğŸŒ™ ä»Šæ—¥ã®å‘¨æ³¢æ•°ãƒ¡ãƒ¢</label>
                <textarea class="magical-textarea" placeholder="ã©ã‚“ãªæ°—æŒã¡ã§éã”ã™ï¼Ÿé¡˜ã„ã¯ï¼Ÿ" id="dayMemo" style="min-height: 100px;"></textarea>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="magical-button" onclick="saveDayMemo()">
                    ğŸ’ è¨˜éŒ²ã™ã‚‹
                </button>
            </div>
        </div>
    </div>
    
    <!-- ä»Šæ—¥ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”»é¢ -->
    <div class="screen hidden" id="message">
        <h2 class="magical-title" style="font-size: 28px;">å®‡å®™ã‹ã‚‰ã®å°ã</h2>
        
        <div class="moon-phase" style="font-size: 64px;">âœ¨</div>
        
        <div class="message-box" style="background: rgba(255, 215, 0, 0.1); border-color: rgba(255, 215, 0, 0.3);">
            <p style="color: #ffd700; font-size: 20px;" id="dailyTitle">ä»Šæ—¥ã®ã‚ãªãŸã¸</p>
            <p style="color: white; margin-top: 15px; font-size: 18px; line-height: 1.8;" id="dailyMessage">
                ã€Œæã‚Œãšã«æ–°ã—ã„ä¸€æ­©ã‚’è¸ã¿å‡ºã—ã¦ãã ã•ã„ã€‚<br>
                å®‡å®™ã¯ã‚ãªãŸã®å‹‡æ°—ã‚’æ”¯ãˆã€<br>
                å¿…è¦ãªã‚‚ã®ã‚’å¿…è¦ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ä¸ãˆã¦ãã‚Œã¾ã™ã€‚ã€
            </p>
        </div>
        
        <div class="card">
            <h3 style="color: #ffd700;">ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ </h3>
            <p style="margin-top: 10px;" id="luckyItems">
                ğŸŒ™ ãƒ ãƒ¼ãƒ³ã‚¹ãƒˆãƒ¼ãƒ³<br>
                ğŸŒ¸ æ¡œã®èŠ±ã³ã‚‰<br>
                ğŸ’œ ç´«è‰²ã®ã‚‚ã®
            </p>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button class="magical-button" onclick="generateNewMessage()">
                ğŸ”® æ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã‚‹
            </button>
        </div>
        
        <div style="text-align: center; margin-top: 10px;">
            <button class="magical-button" onclick="showScreen('home')" style="background: linear-gradient(135deg, #9370db, #ba55d3);">
                æˆ»ã‚‹
            </button>
        </div>
    </div>
    
    <!-- APIè¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="apiKeyModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeApiKeyModal()">&times;</span>
            <h2 class="magical-title" style="font-size: 28px;">ğŸ”‘ é­”æ³•ã®éµã‚’è¨­å®š</h2>
            
            <div class="message-box">
                <p style="color: #ffd700;">AIæ©Ÿèƒ½ã‚’ä½¿ã†ã«ã¯Google Gemini APIã‚­ãƒ¼ãŒå¿…è¦ã§ã™</p>
            </div>
            
            <div class="form-group">
                <label>âœ¨ Gemini APIã‚­ãƒ¼</label>
                <input type="password" class="magical-input" id="apiKeyInput" placeholder="AIzaSy...">
                <p style="font-size: 12px; color: #ffb6c1; margin-top: 10px;">
                    <a href="https://makersuite.google.com/" target="_blank" style="color: #ff6ec7;">
                        ã“ã“ã‹ã‚‰ç„¡æ–™ã§å–å¾—ã§ãã¾ã™ â†’
                    </a>
                </p>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="magical-button" onclick="saveApiKey()">
                    ğŸŒ™ é­”æ³•ã®éµã‚’ä¿å­˜
                </button>
            </div>
            
            <div style="text-align: center; margin-top: 10px;">
                <button class="magical-button" onclick="skipApiKey()" style="background: linear-gradient(135deg, #9370db, #ba55d3);">
                    ä»Šã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆAIæ©Ÿèƒ½ãªã—ã§ä½¿ã†ï¼‰
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ç®¡ç†
        const appState = {
            currentScreen: 'home',
            userProfile: null,
            notes: [],
            selectedSymbol: null,
            currentMonth: new Date(),
            currentCalendarDate: null,
            currentPeriod: '1year'
        };
        
        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã‚­ãƒ¼
        const STORAGE_KEYS = {
            PROFILE: 'silverCrystal_profile',
            NOTES: 'silverCrystal_notes',
        };
        
        // åˆæœŸåŒ–
        function init() {
            createStars();
            loadUserData();
            updateMoonPhase();
            updateTodayMessage();
            setupSymbolSelection();
            
            // å®šæœŸçš„ãªæ›´æ–°
            setInterval(updateMoonPhase, 60000); // 1åˆ†ã”ã¨
            setInterval(updateTodayMessage, 3600000); // 1æ™‚é–“ã”ã¨
        }
        
        // æ˜Ÿã‚’ç”Ÿæˆ
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 50; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 15 + 5 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        function loadUserData() {
            const profile = localStorage.getItem(STORAGE_KEYS.PROFILE);
            if (profile) {
                appState.userProfile = JSON.parse(profile);
                updateZodiacSign();
            }
            
            const notes = localStorage.getItem(STORAGE_KEYS.NOTES);
            if (notes) {
                appState.notes = JSON.parse(notes);
            }
        }
        
        // ç”»é¢é·ç§»
        function showScreen(screenId) {
            // ã™ã¹ã¦ã®ç”»é¢ã‚’éè¡¨ç¤º
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            
            // æŒ‡å®šã•ã‚ŒãŸç”»é¢ã‚’è¡¨ç¤º
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.remove('hidden');
                appState.currentScreen = screenId;
                
                // ç”»é¢ã”ã¨ã®åˆæœŸåŒ–å‡¦ç†
                if (screenId === 'calendar') {
                    generateCalendar();
                } else if (screenId === 'horoscope' && appState.userProfile) {
                    updateHoroscope();
                }
            }
        }
        
        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä¿å­˜
        function saveProfile() {
            const birthDate = document.getElementById('birthDate').value;
            const birthHour = document.getElementById('birthHour').value;
            const birthMinute = document.getElementById('birthMinute').value;
            const birthPlace = document.getElementById('birthPlace').value;
            
            if (!birthDate) {
                showError('ç”Ÿå¹´æœˆæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            appState.userProfile = {
                birthDate,
                birthHour,
                birthMinute,
                birthPlace,
                createdAt: new Date().toISOString()
            };
            
            localStorage.setItem(STORAGE_KEYS.PROFILE, JSON.stringify(appState.userProfile));
            
            updateZodiacSign();
            showSuccess('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸâœ¨');
            
            setTimeout(() => {
                showScreen('home');
            }, 1500);
        }
        
        // æ˜Ÿåº§ã‚’æ›´æ–°
        function updateZodiacSign() {
            if (!appState.userProfile || !appState.userProfile.birthDate) return;
            
            const date = new Date(appState.userProfile.birthDate);
            const month = date.getMonth() + 1;
            const day = date.getDate();
            
            const zodiacSign = getZodiacSign(month, day);
            const zodiacElement = document.getElementById('zodiacSign');
            if (zodiacElement) {
                zodiacElement.textContent = `${zodiacSign.symbol} ${zodiacSign.name}`;
            }
        }
        
        // æ˜Ÿåº§ã‚’è¨ˆç®—
        function getZodiacSign(month, day) {
            const signs = [
                { name: 'å±±ç¾Šåº§', symbol: 'â™‘', start: [12, 22], end: [1, 19] },
                { name: 'æ°´ç“¶åº§', symbol: 'â™’', start: [1, 20], end: [2, 18] },
                { name: 'é­šåº§', symbol: 'â™“', start: [2, 19], end: [3, 20] },
                { name: 'ç‰¡ç¾Šåº§', symbol: 'â™ˆ', start: [3, 21], end: [4, 19] },
                { name: 'ç‰¡ç‰›åº§', symbol: 'â™‰', start: [4, 20], end: [5, 20] },
                { name: 'åŒå­åº§', symbol: 'â™Š', start: [5, 21], end: [6, 20] },
                { name: 'èŸ¹åº§', symbol: 'â™‹', start: [6, 21], end: [7, 22] },
                { name: 'ç…å­åº§', symbol: 'â™Œ', start: [7, 23], end: [8, 22] },
                { name: 'ä¹™å¥³åº§', symbol: 'â™', start: [8, 23], end: [9, 22] },
                { name: 'å¤©ç§¤åº§', symbol: 'â™', start: [9, 23], end: [10, 22] },
                { name: 'è åº§', symbol: 'â™', start: [10, 23], end: [11, 21] },
                { name: 'å°„æ‰‹åº§', symbol: 'â™', start: [11, 22], end: [12, 21] }
            ];
            
            for (const sign of signs) {
                if ((month === sign.start[0] && day >= sign.start[1]) ||
                    (month === sign.end[0] && day <= sign.end[1])) {
                    return sign;
                }
            }
            
            return signs[0]; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å±±ç¾Šåº§
        }
        
        // æœˆç›¸ã‚’æ›´æ–°
        function updateMoonPhase() {
            const moonPhases = ['ğŸŒ‘', 'ğŸŒ’', 'ğŸŒ“', 'ğŸŒ”', 'ğŸŒ•', 'ğŸŒ–', 'ğŸŒ—', 'ğŸŒ˜'];
            const phaseNames = ['æ–°æœˆ', 'ä¸‰æ—¥æœˆ', 'ä¸Šå¼¦ã®æœˆ', 'åä¸‰å¤œæœˆ', 'æº€æœˆ', 'å¯å¾…æœˆ', 'ä¸‹å¼¦ã®æœˆ', 'æœ‰æ˜æœˆ'];
            
            // ç°¡æ˜“çš„ãªæœˆç›¸è¨ˆç®—ï¼ˆå®Ÿéš›ã®å¤©æ–‡å­¦çš„è¨ˆç®—ã§ã¯ãªã„ï¼‰
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            const day = now.getDate();
            
            // 2000å¹´1æœˆ6æ—¥ã®æ–°æœˆã‚’åŸºæº–
            const baseNewMoon = new Date(2000, 0, 6);
            const lunarCycle = 29.53058867; // æœ”æœ›æœˆ
            
            const daysSinceBase = (now - baseNewMoon) / (1000 * 60 * 60 * 24);
            const currentCycle = daysSinceBase / lunarCycle;
            const moonAge = (currentCycle - Math.floor(currentCycle)) * lunarCycle;
            
            const phaseIndex = Math.round(moonAge / lunarCycle * 8) % 8;
            
            document.getElementById('currentMoonPhase').textContent = moonPhases[phaseIndex];
            
            const moonPhaseInfo = document.getElementById('moonPhaseInfo');
            if (moonPhaseInfo) {
                moonPhaseInfo.textContent = `${moonPhases[phaseIndex]} ${phaseNames[phaseIndex]} - ${getMoonPhaseMessage(phaseIndex)}`;
            }
        }
        
        // æœˆç›¸ã«å¿œã˜ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        function getMoonPhaseMessage(phaseIndex) {
            const messages = [
                'æ–°ã—ã„å§‹ã¾ã‚Šã®æ™‚',
                'æ„å›³ã‚’è‚²ã‚€æ™‚',
                'è¡Œå‹•ã‚’èµ·ã“ã™æ™‚',
                'èª¿æ•´ã¨æ„Ÿè¬ã®æ™‚',
                'åç©«ã¨é”æˆã®æ™‚',
                'åˆ†ã‹ã¡åˆã„ã®æ™‚',
                'æ‰‹æ”¾ã—ã¨æµ„åŒ–ã®æ™‚',
                'ä¼‘æ¯ã¨å†…çœã®æ™‚'
            ];
            return messages[phaseIndex];
        }
        
        // ä»Šæ—¥ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ›´æ–°
        function updateTodayMessage() {
            const messages = [
                {
                    title: 'æ˜Ÿã€…ãŒè¦‹å®ˆã‚‹å¤œ',
                    message: 'æ–°ã—ã„æ‰‰ã‚’é–‹ãå‹‡æ°—ã‚’æŒã£ã¦ã€‚æœˆã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒã‚ãªãŸã®èƒŒä¸­ã‚’æŠ¼ã—ã¦ã„ã¾ã™'
                },
                {
                    title: 'å…‰ã®é“ç­‹',
                    message: 'ä»Šæ—¥ã¯ç›´æ„Ÿã‚’ä¿¡ã˜ã¦ã€‚å®‡å®™ã‹ã‚‰ã®ã‚µã‚¤ãƒ³ãŒã€ã‚ãªãŸã‚’æ­£ã—ã„æ–¹å‘ã¸å°ãã¾ã™'
                },
                {
                    title: 'é­”æ³•ã®ç¬é–“',
                    message: 'å°ã•ãªå¥‡è·¡ã«æ°—ã¥ãæ—¥ã€‚æ—¥å¸¸ã®ä¸­ã«éš ã‚ŒãŸç¾ã—ã•ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„'
                },
                {
                    title: 'å¤‰å®¹ã®é¢¨',
                    message: 'å¤‰åŒ–ã‚’æã‚Œãªã„ã§ã€‚ãã‚Œã¯æˆé•·ã¸ã®å¤§åˆ‡ãªã‚¹ãƒ†ãƒƒãƒ—ã§ã™'
                },
                {
                    title: 'æ„›ã®çµæ™¶',
                    message: 'æ„›ã¨æ„Ÿè¬ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’é€ã‚Šã¾ã—ã‚‡ã†ã€‚ãã‚Œã¯å¿…ãšè¿”ã£ã¦ãã¾ã™'
                }
            ];
            
            const today = new Date();
            const dayIndex = today.getDate() % messages.length;
            const todayMsg = messages[dayIndex];
            
            document.getElementById('todayTitle').textContent = todayMsg.title;
            document.getElementById('todayMessage').textContent = `ã€Œ${todayMsg.message}ã€`;
        }
        
        // ã‚·ãƒ³ãƒœãƒ«é¸æŠã®è¨­å®š
        function setupSymbolSelection() {
            const symbols = document.querySelectorAll('.symbol');
            symbols.forEach(symbol => {
                symbol.addEventListener('click', function() {
                    symbols.forEach(s => s.classList.remove('selected'));
                    this.classList.add('selected');
                    appState.selectedSymbol = this.dataset.symbol;
                    
                    // ã‚·ãƒ³ãƒœãƒ«ã®æ„å‘³ã‚’è¡¨ç¤º
                    const meaning = this.dataset.meaning;
                    const meanings = {
                        moon: 'æœˆã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒã‚ãªãŸã®ç›´æ„Ÿã‚’å°ãã€æ–°ãŸãªå§‹ã¾ã‚Šã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™',
                        star: 'æ˜Ÿã®å…‰ãŒã‚ãªãŸã®é“ã‚’ç…§ã‚‰ã—ã€å¸Œæœ›ã¨å‹‡æ°—ã‚’ä¸ãˆã¦ãã‚Œã¾ã™',
                        flower: 'èŠ±ã®ã‚ˆã†ã«è‡ªç„¶ã«é–‹èŠ±ã™ã‚‹æ™‚ã€‚ã‚ãªãŸã®é­…åŠ›ãŒè¼ãã¾ã™',
                        crystal: 'éŠ€æ°´æ™¶ã®æµ„åŒ–ãƒ‘ãƒ¯ãƒ¼ã§ã€ãƒã‚¬ãƒ†ã‚£ãƒ–ãªã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ã‚¯ãƒªã‚¢ã«',
                        butterfly: 'è¶ã®ã‚ˆã†ã«è»½ã‚„ã‹ã«å¤‰å®¹ã—ã€æ–°ã—ã„è‡ªåˆ†ã«ç”Ÿã¾ã‚Œå¤‰ã‚ã‚Šã¾ã™'
                    };
                    document.getElementById('symbolMessage').textContent = meanings[this.dataset.symbol];
                });
            });
        }
        
        // ãƒãƒ¼ãƒˆã‚’ä¿å­˜
        function saveNote() {
            const content = document.getElementById('noteContent').value;
            if (!content.trim()) {
                showError('é¡˜ã„ã‚„æ„å›³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (!appState.selectedSymbol) {
                showError('è±¡å¾´ã‚’é¸ã‚“ã§ãã ã•ã„');
                return;
            }
            
            const note = {
                id: Date.now(),
                content: content,
                symbol: appState.selectedSymbol,
                moonPhase: document.getElementById('currentMoonPhase').textContent,
                createdAt: new Date().toISOString()
            };
            
            appState.notes.push(note);
            localStorage.setItem(STORAGE_KEYS.NOTES, JSON.stringify(appState.notes));
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('noteContent').value = '';
            document.querySelectorAll('.symbol').forEach(s => s.classList.remove('selected'));
            appState.selectedSymbol = null;
            
            showSuccess('é¡˜ã„ãŒå®‡å®™ã«é€ã‚‰ã‚Œã¾ã—ãŸâœ¨');
            
            // æ–°ã—ã„AIã®å•ã„ã‹ã‘ã‚’ç”Ÿæˆ
            generateNewAIQuestion();
        }
        
        // æ–°ã—ã„AIã®å•ã„ã‹ã‘ã‚’ç”Ÿæˆ
        async function generateNewAIQuestion() {
            if (GEMINI_API_KEY) {
                const moonPhase = document.getElementById('currentMoonPhase').textContent;
                const prompt = `ã‚ãªãŸã¯å¹»ã®éŠ€æ°´æ™¶ã®ãƒã‚¸ã‚«ãƒ«ãƒãƒ¼ãƒˆAIã§ã™ã€‚ã‚»ãƒ¼ãƒ©ãƒ¼ãƒ ãƒ¼ãƒ³ã®ä¸–ç•Œè¦³ã§ã€ä»Šã®æœˆç›¸ãŒ${moonPhase}ã®æ™‚ã®ãƒã‚¸ã‚«ãƒ«ãªå•ã„ã‹ã‘ã‚’1ã¤ä½œã£ã¦ãã ã•ã„ã€‚50æ–‡å­—ä»¥å†…ã§ã€‚`;
                
                const result = await callGeminiAPI(prompt);
                if (result) {
                    document.getElementById('aiQuestion').innerHTML = `ã€Œ${result}ã€`;
                    return;
                }
            }
            
            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            const questions = [
                'ä»Šã®æ˜Ÿã®æµã‚Œã¯ã€ˆæˆé•·ã€‰ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã€‚ã©ã‚“ãªç¨®ã‚’è’”ãã¾ã™ã‹ï¼Ÿ',
                'æœˆãŒæ•™ãˆã¦ãã‚Œã¦ã„ã¾ã™ã€‚ã€ˆè§£æ”¾ã€‰ã®æ™‚ã€‚ä½•ã‹ã‚‰è‡ªç”±ã«ãªã‚ŠãŸã„ã§ã™ã‹ï¼Ÿ',
                'å®‡å®™ã¯ã€ˆèª¿å’Œã€‰ã‚’æ±‚ã‚ã¦ã„ã¾ã™ã€‚ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚Šæˆ»ã™ã«ã¯ï¼Ÿ',
                'æ˜ŸãŸã¡ãŒã€ˆå‰µé€ ã€‰ã‚’ä¿ƒã—ã¦ã„ã¾ã™ã€‚ä½•ã‚’ç”Ÿã¿å‡ºã—ãŸã„ã§ã™ã‹ï¼Ÿ',
                'ä»Šã¯ã€ˆå—å®¹ã€‰ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‚å—ã‘å…¥ã‚Œã‚‹æº–å‚™ã¯ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ'
            ];
            
            const randomIndex = Math.floor(Math.random() * questions.length);
            document.getElementById('aiQuestion').innerHTML = `ã€Œ${questions[randomIndex]}ã€`;
        }
        
        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ç”Ÿæˆ
        function generateCalendar() {
            const year = appState.currentMonth.getFullYear();
            const month = appState.currentMonth.getMonth();
            
            document.getElementById('currentMonth').textContent = `${year}å¹´${month + 1}æœˆ`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';
            
            // æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼
            const weekDays = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            weekDays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.style.textAlign = 'center';
                dayHeader.style.color = '#ffb6c1';
                dayHeader.style.fontSize = '12px';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });
            
            // ç©ºç™½ã®ã‚»ãƒ«
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                calendarGrid.appendChild(emptyCell);
            }
            
            // æ—¥ä»˜ã‚»ãƒ«
            for (let date = 1; date <= lastDate; date++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';
                dayCell.textContent = date;
                
                // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                if (year === today.getFullYear() && 
                    month === today.getMonth() && 
                    date === today.getDate()) {
                    dayCell.classList.add('today');
                }
                
                // æœˆç›¸ã‚’è¨ˆç®—
                const moonPhase = getMoonPhaseForDate(year, month, date);
                if (moonPhase === 'new-moon') {
                    dayCell.classList.add('new-moon');
                    dayCell.innerHTML = `${date}<span style="font-size: 10px;">ğŸŒ‘</span>`;
                } else if (moonPhase === 'full-moon') {
                    dayCell.classList.add('full-moon');
                    dayCell.innerHTML = `${date}<span style="font-size: 10px;">ğŸŒ•</span>`;
                }
                
                // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                dayCell.addEventListener('click', () => openCalendarModal(year, month, date));
                
                calendarGrid.appendChild(dayCell);
            }
        }
        
        // æœˆã‚’å¤‰æ›´
        function changeMonth(direction) {
            appState.currentMonth.setMonth(appState.currentMonth.getMonth() + direction);
            generateCalendar();
        }
        
        // æœˆç›¸ã‚’è¨ˆç®—ï¼ˆç°¡æ˜“ç‰ˆï¼‰
        function getMoonPhaseForDate(year, month, date) {
            const targetDate = new Date(year, month, date);
            const baseNewMoon = new Date(2000, 0, 6);
            const lunarCycle = 29.53058867;
            
            const daysSinceBase = (targetDate - baseNewMoon) / (1000 * 60 * 60 * 24);
            const currentCycle = daysSinceBase / lunarCycle;
            const moonAge = (currentCycle - Math.floor(currentCycle)) * lunarCycle;
            
            if (moonAge < 1.5 || moonAge > 28) {
                return 'new-moon';
            } else if (moonAge > 13.5 && moonAge < 15.5) {
                return 'full-moon';
            }
            return null;
        }
        
        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        function openCalendarModal(year, month, date) {
            const modalDate = new Date(year, month, date);
            const dateStr = `${year}å¹´${month + 1}æœˆ${date}æ—¥`;
            
            document.getElementById('modalDate').textContent = dateStr;
            
            // æœˆç›¸ã«å¿œã˜ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            const moonPhase = getMoonPhaseForDate(year, month, date);
            let flow = '';
            
            if (moonPhase === 'new-moon') {
                flow = 'ğŸŒ‘ æ–°æœˆã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã€‚æ–°ã—ã„é¡˜ã„ã‚’å®‡å®™ã«é€ã‚‹æœ€é«˜ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‚ç‘æƒ³ã‚„å†…çœã«é©ã—ãŸæ—¥ã€‚';
            } else if (moonPhase === 'full-moon') {
                flow = 'ğŸŒ• æº€æœˆã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã€‚æ„Ÿè¬ã¨æ‰‹æ”¾ã—ã®æ™‚ã€‚ä¸è¦ãªã‚‚ã®ã‚’æµ„åŒ–ã—ã€è±Šã‹ã•ã‚’å—ã‘å–ã‚‹æº–å‚™ã‚’ã€‚';
            } else {
                const dayOfWeek = modalDate.getDay();
                const flows = [
                    'æ—¥æ›œæ—¥ï¼šå¤ªé™½ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã€‚è‡ªä¿¡ã¨æ´»åŠ›ã«æº€ã¡ãŸä¸€æ—¥ã€‚ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®ã—ã¦ã€‚',
                    'æœˆæ›œæ—¥ï¼šæœˆã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã€‚æ„Ÿæƒ…ã¨ç›´æ„Ÿã‚’å¤§åˆ‡ã«ã€‚å®¶æ—ã‚„è¦ªã—ã„äººã¨ã®æ™‚é–“ã‚’ã€‚',
                    'ç«æ›œæ—¥ï¼šç«æ˜Ÿã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã€‚è¡Œå‹•åŠ›ãŒé«˜ã¾ã‚‹æ—¥ã€‚ãƒãƒ£ãƒ¬ãƒ³ã‚¸ç²¾ç¥ã‚’æŒã£ã¦ã€‚',
                    'æ°´æ›œæ—¥ï¼šæ°´æ˜Ÿã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã€‚ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«æœ€é©ã€‚å­¦ã³ã‚„äº¤æµã‚’æ·±ã‚ã¦ã€‚',
                    'æœ¨æ›œæ—¥ï¼šæœ¨æ˜Ÿã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã€‚å¹¸é‹ã¨æ‹¡å¤§ã®æ—¥ã€‚æ–°ã—ã„ãƒãƒ£ãƒ³ã‚¹ã«å¿ƒã‚’é–‹ã„ã¦ã€‚',
                    'é‡‘æ›œæ—¥ï¼šé‡‘æ˜Ÿã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã€‚æ„›ã¨ç¾ã®æ—¥ã€‚è‡ªåˆ†ã‚’å¤§åˆ‡ã«ã€ç¾ã—ã„ã‚‚ã®ã«è§¦ã‚Œã¦ã€‚',
                    'åœŸæ›œæ—¥ï¼šåœŸæ˜Ÿã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã€‚åŠªåŠ›ãŒå®Ÿã‚’çµã¶æ—¥ã€‚é•·æœŸçš„ãªè¨ˆç”»ã‚’ç«‹ã¦ã‚‹ã®ã«æœ€é©ã€‚'
                ];
                flow = flows[dayOfWeek];
            }
            
            document.getElementById('dayFlow').textContent = flow;
            
            // ä¿å­˜ã•ã‚ŒãŸãƒ¡ãƒ¢ã‚’èª­ã¿è¾¼ã‚€
            const memoKey = `memo_${year}_${month}_${date}`;
            const savedMemo = localStorage.getItem(memoKey) || '';
            document.getElementById('dayMemo').value = savedMemo;
            
            // ç¾åœ¨ã®æ—¥ä»˜ã‚’ä¿å­˜
            appState.currentCalendarDate = { year, month, date };
            
            document.getElementById('calendarModal').style.display = 'block';
        }
        
        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeCalendarModal() {
            document.getElementById('calendarModal').style.display = 'none';
        }
        
        // æ—¥ä»˜ã®ãƒ¡ãƒ¢ã‚’ä¿å­˜
        function saveDayMemo() {
            const memo = document.getElementById('dayMemo').value;
            const { year, month, date } = appState.currentCalendarDate;
            const memoKey = `memo_${year}_${month}_${date}`;
            
            localStorage.setItem(memoKey, memo);
            showSuccess('å‘¨æ³¢æ•°ãƒ¡ãƒ¢ã‚’è¨˜éŒ²ã—ã¾ã—ãŸâœ¨');
            
            setTimeout(() => {
                closeCalendarModal();
            }, 1500);
        }
        
        // ãƒ›ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æ›´æ–°
        function updateHoroscope() {
            if (!appState.userProfile) return;
            
            // ç°¡æ˜“çš„ãªãƒ›ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ç”Ÿæˆ
            const horoscopes = [
                'ç«æ˜ŸãŒã‚ãªãŸã®æ‹æ„›å®®ã«å…¥ã‚Šã€æƒ…ç†±çš„ãªã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒé«˜ã¾ã‚Šã¾ã™ã€‚æ–°ã—ã„å‡ºä¼šã„ã‚„æ—¢å­˜ã®é–¢ä¿‚ã®æ·±ã¾ã‚ŠãŒæœŸå¾…ã§ãã‚‹æ™‚æœŸã§ã™ã€‚',
                'æ°´æ˜ŸãŒé€†è¡Œã‚’çµ‚ãˆã€ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã¾ã™ã€‚å»¶æœŸã—ã¦ã„ãŸè¨ˆç”»ã‚’å®Ÿè¡Œã«ç§»ã™è‰¯ã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã™ã€‚',
                'é‡‘æ˜Ÿã¨æœ¨æ˜ŸãŒèª¿å’Œçš„ãªè§’åº¦ã‚’å½¢æˆã—ã€è±Šã‹ã•ã¨å¹¸é‹ãŒã‚ãªãŸã«å¾®ç¬‘ã¿ã¾ã™ã€‚ãƒãƒ£ãƒ³ã‚¹ã‚’é€ƒã•ãªã„ã‚ˆã†ã«ã€‚',
                'åœŸæ˜ŸãŒã‚ãªãŸã®æˆé•·ã‚’ä¿ƒã—ã¦ã„ã¾ã™ã€‚å›°é›£ã«è¦‹ãˆã‚‹ã“ã¨ã‚‚ã€é•·æœŸçš„ã«ã¯ã‚ãªãŸã®å¼·ã•ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚',
                'æµ·ç‹æ˜Ÿã®å½±éŸ¿ã§ç›´æ„ŸåŠ›ãŒé«˜ã¾ã£ã¦ã„ã¾ã™ã€‚å¤¢ã‚„ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«æ³¨æ„ã‚’æ‰•ã£ã¦ãã ã•ã„ã€‚'
            ];
            
            const weeklyIndex = new Date().getDay() % horoscopes.length;
            document.getElementById('weeklyHoroscope').textContent = horoscopes[weeklyIndex];
        }
        
        // Gemini APIè¨­å®š
        let GEMINI_API_KEY = localStorage.getItem('silverCrystal_apiKey') || '';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';
        
        // Gemini APIã‚’ä½¿ã£ã¦æ˜Ÿèª­ã¿ã‚’ç”Ÿæˆ
        async function callGeminiAPI(prompt) {
            try {
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });
                
                if (!response.ok) {
                    throw new Error('API request failed');
                }
                
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error('Gemini API Error:', error);
                return null;
            }
        }
        
        // æœŸé–“ã‚’åˆ‡ã‚Šæ›¿ãˆ
        function changePeriod(period) {
            appState.currentPeriod = period;
            
            // ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ›´æ–°
            ['1year', '5years', '10years'].forEach(p => {
                const btn = document.getElementById(`btn${p}`);
                if (p === period) {
                    btn.style.background = 'linear-gradient(135deg, #ff6ec7, #ff9472)';
                } else {
                    btn.style.background = 'linear-gradient(135deg, #9370db, #ba55d3)';
                }
            });
            
            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æ›´æ–°
            updateTransitionPeriods(period);
        }
        
        // è»¢æ›æœŸã‚’æ›´æ–°
        function updateTransitionPeriods(period) {
            const titleMap = {
                '1year': 'ä»Šå¾Œ1å¹´ã®é‡è¦ãªè»¢æ›æœŸ',
                '5years': 'ä»Šå¾Œ5å¹´ã®é‡è¦ãªè»¢æ›æœŸ',
                '10years': 'ä»Šå¾Œ10å¹´ã®é‡è¦ãªè»¢æ›æœŸ'
            };
            
            document.querySelector('#horoscopeContent h3').textContent = titleMap[period];
            
            const periodsDiv = document.getElementById('transitionPeriods');
            periodsDiv.innerHTML = '';
            
            // æœŸé–“ã«å¿œã˜ãŸè»¢æ›æœŸã‚’ç”Ÿæˆ
            let transitions = [];
            
            if (period === '1year') {
                transitions = [
                    { date: '2æœˆ14æ—¥', title: 'æ„›ã¨èª¿å’Œã®æ™‚æœŸ', desc: 'é‡‘æ˜ŸãŒã‚ãªãŸã®æ‹æ„›å®®ã«å…¥ã‚Šã¾ã™ã€‚æ–°ã—ã„å‡ºä¼šã„ã‚„ã€æ—¢å­˜ã®é–¢ä¿‚ãŒæ·±ã¾ã‚‹ãƒãƒ£ãƒ³ã‚¹ã€‚è‡ªåˆ†ã®é­…åŠ›ã‚’ä¿¡ã˜ã¦ç©æ¥µçš„ã«ã€‚' },
                    { date: '5æœˆ20æ—¥', title: 'å¤‰é©ã¨æˆé•·ã®æ™‚æœŸ', desc: 'å¤©ç‹æ˜Ÿã®å½±éŸ¿ã§å¤§ããªå¤‰åŒ–ãŒã€‚ã‚­ãƒ£ãƒªã‚¢ã‚„ç”Ÿæ´»ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¦‹ç›´ã™è‰¯ã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‚å¤‰åŒ–ã‚’æã‚Œãšå—ã‘å…¥ã‚Œã¦ã€‚' },
                    { date: '9æœˆ10æ—¥', title: 'åç©«ã¨é”æˆã®æ™‚æœŸ', desc: 'åŠªåŠ›ãŒå®Ÿã‚’çµã¶æ™‚ã€‚ã“ã‚Œã¾ã§ã®é ‘å¼µã‚ŠãŒè©•ä¾¡ã•ã‚Œã€æ–°ãŸãªãƒãƒ£ãƒ³ã‚¹ãŒè¨ªã‚Œã¾ã™ã€‚æ„Ÿè¬ã®æ°—æŒã¡ã‚’å¿˜ã‚Œãšã«ã€‚' }
                ];
            } else if (period === '5years') {
                transitions = [
                    { date: '2025å¹´ç§‹', title: 'äººç”Ÿã®è»¢æ©Ÿ', desc: 'é‡è¦ãªæ±ºæ–­ã‚’è¿«ã‚‰ã‚Œã‚‹æ™‚æœŸã€‚ç›´æ„Ÿã‚’ä¿¡ã˜ã¦ã€å¿ƒã®å£°ã«å¾“ã£ã¦ã€‚ã“ã®é¸æŠãŒã‚ãªãŸã®æœªæ¥ã‚’å¤§ããå¤‰ãˆã¾ã™ã€‚' },
                    { date: '2027å¹´æ˜¥', title: 'é–‹èŠ±ã®æ™‚æœŸ', desc: 'ã“ã‚Œã¾ã§è‚²ã¦ã¦ããŸã‚‚ã®ãŒèŠ±é–‹ãæ™‚ã€‚æ‰èƒ½ãŒèªã‚ã‚‰ã‚Œã€æ–°ã—ã„ã‚¹ãƒ†ãƒ¼ã‚¸ã¸ã€‚è¬™è™šã•ã‚’å¿˜ã‚Œãšã«ã€‚' },
                    { date: '2029å¹´å†¬', title: 'æ–°ãŸãªå§‹ã¾ã‚Š', desc: 'ä¸€ã¤ã®ã‚µã‚¤ã‚¯ãƒ«ãŒçµ‚ã‚ã‚Šã€æ–°ã—ã„å†’é™ºãŒå§‹ã¾ã‚Šã¾ã™ã€‚éå»ã«æ„Ÿè¬ã—ã€æœªæ¥ã«å¸Œæœ›ã‚’æŒã£ã¦é€²ã‚“ã§ãã ã•ã„ã€‚' }
                ];
            } else if (period === '10years') {
                transitions = [
                    { date: '2026-2028å¹´', title: 'åŸºç›¤ä½œã‚Šã®æ™‚æœŸ', desc: 'äººç”Ÿã®åœŸå°ã‚’å›ºã‚ã‚‹é‡è¦ãªæ™‚æœŸã€‚å®¶æ—ã€ã‚­ãƒ£ãƒªã‚¢ã€å¥åº·ãªã©ã€é•·æœŸçš„ãªè¦–ç‚¹ã§è¨ˆç”»ã‚’ç«‹ã¦ã¦ã€‚' },
                    { date: '2030-2032å¹´', title: 'é£›èºã®æ™‚æœŸ', desc: 'ã‚ãªãŸã®çœŸä¾¡ãŒç™ºæ®ã•ã‚Œã‚‹æ™‚ã€‚ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’å–ã‚Šã€å‘¨ã‚Šã«è‰¯ã„å½±éŸ¿ã‚’ä¸ãˆã‚‹å­˜åœ¨ã«ã€‚' },
                    { date: '2034-2035å¹´', title: 'çµ±åˆã¨æˆç†Ÿã®æ™‚æœŸ', desc: 'äººç”ŸçµŒé¨“ãŒæ™ºæ…§ã¨ãªã‚Šã€ä»–è€…ã‚’å°ãç«‹å ´ã«ã€‚å†…ãªã‚‹å¹³å’Œã¨å¤–çš„æˆåŠŸã®ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Œã‚‹æ™‚ã€‚' }
                ];
            }
            
            transitions.forEach(t => {
                const item = document.createElement('div');
                item.className = 'transition-item';
                item.style.cssText = 'background: rgba(255, 192, 203, 0.1); border-radius: 15px; padding: 15px; margin: 10px 0;';
                item.innerHTML = `
                    <p style="color: #ffd700; font-weight: bold;">ğŸ“… ${t.date} - ${t.title}</p>
                    <p style="font-size: 14px; margin-top: 5px;">${t.desc}</p>
                `;
                periodsDiv.appendChild(item);
            });
        }
        
        // æ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆ
        async function generateNewMessage() {
            showMessage('å®‡å®™ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ä¸­...');
            
            if (GEMINI_API_KEY && appState.userProfile) {
                const zodiac = getZodiacSign(
                    new Date(appState.userProfile.birthDate).getMonth() + 1,
                    new Date(appState.userProfile.birthDate).getDate()
                );
                
                const prompt = `ã‚ãªãŸã¯å¹»ã®éŠ€æ°´æ™¶ã®å®ˆè­·è€…ã§ã™ã€‚ã‚»ãƒ¼ãƒ©ãƒ¼ãƒ ãƒ¼ãƒ³ã®ä¸–ç•Œè¦³ã§ã€${zodiac.name}ã®ä»Šæ—¥ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œã£ã¦ãã ã•ã„ã€‚å¸Œæœ›ã¨æ„›ã«æº€ã¡ãŸç¾ã—ã„è¨€è‘‰ã§100æ–‡å­—ä»¥å†…ã€‚ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã‚‚3ã¤ææ¡ˆã—ã¦ãã ã•ã„ã€‚`;
                
                const result = await callGeminiAPI(prompt);
                if (result) {
                    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã‚’åˆ†é›¢
                    const lines = result.split('\n');
                    const message = lines[0];
                    const items = lines.slice(1).join('\n') || 'ğŸŒ™ ãƒ ãƒ¼ãƒ³ã‚¹ãƒˆãƒ¼ãƒ³\nâ­ æ˜Ÿã®ãŠå®ˆã‚Š\nğŸ’ ã‚¯ãƒªã‚¹ã‚¿ãƒ«';
                    
                    document.getElementById('dailyMessage').innerHTML = `ã€Œ${message}ã€`;
                    document.getElementById('luckyItems').innerHTML = items;
                    
                    showSuccess('æ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã‚Šã¾ã—ãŸâœ¨');
                    createSparkleEffect();
                    return;
                }
            }
            
            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            const titles = [
                'å®‡å®™ã‹ã‚‰ã®æ„›',
                'æ˜ŸãŸã¡ã®å›ã',
                'æœˆã®å°ã',
                'å¤©ä½¿ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸',
                'å…‰ã®ç¥ç¦'
            ];
            
            const messages = [
                'æã‚Œãšã«æ–°ã—ã„ä¸€æ­©ã‚’è¸ã¿å‡ºã—ã¦ãã ã•ã„ã€‚å®‡å®™ã¯ã‚ãªãŸã®å‹‡æ°—ã‚’æ”¯ãˆã€å¿…è¦ãªã‚‚ã®ã‚’å¿…è¦ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ä¸ãˆã¦ãã‚Œã¾ã™ã€‚',
                'ã‚ãªãŸã®å†…ãªã‚‹å…‰ã‚’ä¿¡ã˜ã¦ãã ã•ã„ã€‚ãã®è¼ãã¯ã€å‘¨ã‚Šã®äººã€…ã«ã‚‚å¸Œæœ›ã‚’ä¸ãˆã¾ã™ã€‚',
                'ä»Šæ—¥ã¨ã„ã†æ—¥ã¯äºŒåº¦ã¨æ¥ã¾ã›ã‚“ã€‚ã“ã®ç¬é–“ã‚’å¤§åˆ‡ã«ã€æ„›ã‚’æŒã£ã¦ç”Ÿãã¦ãã ã•ã„ã€‚',
                'å›°é›£ã¯æˆé•·ã®ãƒãƒ£ãƒ³ã‚¹ã§ã™ã€‚å®‡å®™ã¯ã‚ãªãŸãŒä¹—ã‚Šè¶Šãˆã‚‰ã‚Œã‚‹è©¦ç·´ã—ã‹ä¸ãˆã¾ã›ã‚“ã€‚',
                'æ„Ÿè¬ã®å¿ƒã‚’æŒã¤ã“ã¨ã§ã€ã•ã‚‰ãªã‚‹è±Šã‹ã•ãŒã‚ãªãŸã®äººç”Ÿã«æµã‚Œè¾¼ã‚“ã§ãã¾ã™ã€‚'
            ];
            
            const luckyItems = [
                'ğŸŒ™ ãƒ ãƒ¼ãƒ³ã‚¹ãƒˆãƒ¼ãƒ³\nğŸŒ¸ æ¡œã®èŠ±ã³ã‚‰\nğŸ’œ ç´«è‰²ã®ã‚‚ã®',
                'â­ æ˜Ÿå‹ã®ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼\nğŸŒ¹ èµ¤ã„ãƒãƒ©\nğŸ’ ã‚¯ãƒªã‚¹ã‚¿ãƒ«',
                'ğŸ¦‹ è¶ã®ãƒ¢ãƒãƒ¼ãƒ•\nğŸŒ» ã²ã¾ã‚ã‚Š\nğŸ’™ é’ã„çŸ³',
                'ğŸŒˆ è™¹è‰²ã®ã‚‚ã®\nğŸ€ å››ã¤è‘‰ã®ã‚¯ãƒ­ãƒ¼ãƒãƒ¼\nğŸ’š ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰',
                'âœ¨ ã‚­ãƒ©ã‚­ãƒ©ã—ãŸã‚‚ã®\nğŸŒº ãƒã‚¤ãƒ“ã‚¹ã‚«ã‚¹\nğŸ’› é»„è‰²ã„èŠ±'
            ];
            
            const randomIndex = Math.floor(Math.random() * titles.length);
            
            document.getElementById('dailyTitle').textContent = titles[randomIndex];
            document.getElementById('dailyMessage').innerHTML = `ã€Œ${messages[randomIndex]}ã€`;
            document.getElementById('luckyItems').innerHTML = luckyItems[randomIndex];
            
            showSuccess('æ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã‚Šã¾ã—ãŸâœ¨');
            createSparkleEffect();
        }
        
        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        function showError(message) {
            showMessage(message, 'error');
        }
        
        // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        function showSuccess(message) {
            showMessage(message, 'success');
        }
        
        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        function showMessage(message, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;
            messageDiv.style.position = 'fixed';
            messageDiv.style.top = '20px';
            messageDiv.style.left = '50%';
            messageDiv.style.transform = 'translateX(-50%)';
            messageDiv.style.zIndex = '1000';
            messageDiv.style.maxWidth = '80%';
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.style.opacity = '0';
                messageDiv.style.transition = 'opacity 0.5s';
                setTimeout(() => {
                    document.body.removeChild(messageDiv);
                }, 500);
            }, 3000);
        }
        
        // ã‚­ãƒ©ã‚­ãƒ©ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
        function createSparkleEffect() {
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    sparkle.innerHTML = 'âœ¨';
                    sparkle.style.position = 'fixed';
                    sparkle.style.fontSize = '30px';
                    sparkle.style.pointerEvents = 'none';
                    sparkle.style.left = Math.random() * window.innerWidth + 'px';
                    sparkle.style.top = Math.random() * window.innerHeight + 'px';
                    sparkle.style.animation = 'twinkle 2s ease-out';
                    document.body.appendChild(sparkle);
                    
                    setTimeout(() => sparkle.remove(), 2000);
                }, i * 100);
            }
        }
        
        // ã‚«ãƒ¼ã‚½ãƒ«ã«è¿½å¾“ã™ã‚‹ã‚­ãƒ©ã‚­ãƒ©
        document.addEventListener('mousemove', (e) => {
            if (Math.random() > 0.98) {
                const sparkle = document.createElement('div');
                sparkle.innerHTML = 'âœ¨';
                sparkle.style.position = 'fixed';
                sparkle.style.fontSize = '20px';
                sparkle.style.pointerEvents = 'none';
                sparkle.style.left = e.clientX + 'px';
                sparkle.style.top = e.clientY + 'px';
                sparkle.style.animation = 'twinkle 2s ease-out';
                document.body.appendChild(sparkle);
                
                setTimeout(() => sparkle.remove(), 2000);
            }
        });
        
        // APIã‚­ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
        function showApiKeyModal() {
            document.getElementById('apiKeyModal').style.display = 'block';
        }
        
        // APIã‚­ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeApiKeyModal() {
            document.getElementById('apiKeyModal').style.display = 'none';
        }
        
        // APIã‚­ãƒ¼ã‚’ä¿å­˜
        function saveApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            if (!apiKey) {
                showError('APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            GEMINI_API_KEY = apiKey;
            localStorage.setItem('silverCrystal_apiKey', apiKey);
            
            showSuccess('é­”æ³•ã®éµãŒä¿å­˜ã•ã‚Œã¾ã—ãŸâœ¨');
            closeApiKeyModal();
            
            // AIæ©Ÿèƒ½ã‚’å†è©¦è¡Œ
            if (appState.currentScreen === 'horoscope') {
                generateDetailedHoroscope();
            } else if (appState.currentScreen === 'note') {
                generateNewAIQuestion();
            }
        }
        
        // APIã‚­ãƒ¼ã‚’ã‚¹ã‚­ãƒƒãƒ—
        function skipApiKey() {
            closeApiKeyModal();
            showMessage('AIæ©Ÿèƒ½ãªã—ã§ä½¿ç”¨ã—ã¾ã™');
        }
        
        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆæœŸåŒ–
        init();
        
        // åˆå›èµ·å‹•æ™‚ã«APIã‚­ãƒ¼ãŒæœªè¨­å®šãªã‚‰è¨­å®šç”»é¢ã‚’è¡¨ç¤º
        setTimeout(() => {
            if (!GEMINI_API_KEY) {
                showApiKeyModal();
            }
        }, 1000);
    </script>
</body>
</html>